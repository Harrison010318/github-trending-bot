# GitHub Trending Bot é¡¹ç›®å®ç°æ–¹æ³•æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ GitHub Trending æ—¥æŠ¥æœºå™¨äººï¼Œæ¯å¤©è‡ªåŠ¨æŠ“å– GitHub çƒ­é—¨é¡¹ç›®ï¼Œä½¿ç”¨ AI ç”Ÿæˆç²¾ç¾çš„ä¸­æ–‡æ‘˜è¦æŠ¥å‘Šï¼Œå¹¶é€šè¿‡é‚®ä»¶å‘é€ç»™ç”¨æˆ·ã€‚

## æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

1. **Node.js è¿è¡Œç¯å¢ƒ**
   - ç‰ˆæœ¬ï¼šv20.x
   - ç”¨äºæ‰§è¡Œä¸»ç¨‹åºé€»è¾‘

2. **å…³é”®ä¾èµ–åº“**
   - `@google/generative-ai`ï¼šGoogle Gemini AI SDK
   - `cheerio`ï¼šHTML è§£æåº“ï¼Œç”¨äºç½‘é¡µæŠ“å–
   - `resend`ï¼šç°ä»£åŒ–çš„é‚®ä»¶å‘é€æœåŠ¡
   - `dotenv`ï¼šç¯å¢ƒå˜é‡ç®¡ç†

3. **GitHub Actions**
   - è‡ªåŠ¨åŒ–è¿è¡Œå¹³å°
   - å®šæ—¶ä»»åŠ¡è°ƒåº¦
   - å…è´¹çš„ CI/CD æœåŠ¡

## å®ç°åŸç†

### 1. æ•°æ®æŠ“å–æ¨¡å—

```javascript
async function fetchGitHubTrending() {
  // è®¿é—® GitHub Trending é¡µé¢
  const response = await fetch("https://github.com/trending");
  const html = await response.text();
  const $ = cheerio.load(html);
  
  // è§£æé¡¹ç›®ä¿¡æ¯
  $("article.Box-row").each((index, element) => {
    // æå–é¡¹ç›®åç§°ã€URLã€æè¿°ã€è¯­è¨€ã€Star æ•°ç­‰
  });
}
```

**å·¥ä½œæµç¨‹ï¼š**
- ä½¿ç”¨ `fetch()` è·å– GitHub Trending é¡µé¢çš„ HTML
- åˆ©ç”¨ `cheerio` è§£æ DOM ç»“æ„
- æå–æ¯ä¸ªé¡¹ç›®çš„å…³é”®ä¿¡æ¯ï¼š
  - é¡¹ç›®åç§°å’Œé“¾æ¥
  - é¡¹ç›®æè¿°
  - ç¼–ç¨‹è¯­è¨€
  - Star æ€»æ•°
  - ä»Šæ—¥æ–°å¢ Star æ•°

### 2. AI å†…å®¹ç”Ÿæˆæ¨¡å—

```javascript
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
const model = genAI.getGenerativeModel({ 
  model: "gemini-2.5-flash" 
});

const result = await model.generateContent(prompt);
const summaryHtml = result.response.text();
```

**ä½¿ç”¨ Gemini AI çš„ä¼˜åŠ¿ï¼š**
- **å…è´¹é¢åº¦å……è¶³**ï¼šgemini-2.5-flash æ¨¡å‹æ¯å¤©æœ‰å¤§é‡å…è´¹è°ƒç”¨
- **ä¸­æ–‡ç†è§£èƒ½åŠ›å¼º**ï¼šèƒ½å¤Ÿç”Ÿæˆé«˜è´¨é‡çš„ä¸­æ–‡æŠ€æœ¯å†…å®¹
- **HTML ç”Ÿæˆèƒ½åŠ›**ï¼šç›´æ¥è¾“å‡ºæ ¼å¼åŒ–çš„ HTML é‚®ä»¶å†…å®¹
- **æ™ºèƒ½åˆ†æ**ï¼šèƒ½å¤Ÿç†è§£é¡¹ç›®ç‰¹ç‚¹å¹¶ç”Ÿæˆæœ‰ä»·å€¼çš„æ‘˜è¦

**Prompt è®¾è®¡è¦ç‚¹ï¼š**
- æ˜ç¡®è¾“å‡ºæ ¼å¼ï¼ˆHTML é‚®ä»¶ï¼‰
- æŒ‡å®šæ ·å¼è¦æ±‚ï¼ˆå†…è” CSSã€é‚®ä»¶å…¼å®¹ï¼‰
- è¦æ±‚æ™ºèƒ½åˆ†ææ¯ä¸ªé¡¹ç›®çš„æ ¸å¿ƒäº®ç‚¹
- æ·»åŠ ç»Ÿè®¡æ‘˜è¦åŒºåŸŸ

### 3. é‚®ä»¶å‘é€æ¨¡å—

```javascript
const resend = new Resend(process.env.RESEND_API_KEY);

await resend.emails.send({
  from: 'GitHub Daily <onboarding@resend.dev>',
  to: [process.env.RECIPIENT_EMAIL],
  subject: `ä»Šæ—¥ GitHub è¶‹åŠ¿æ—©æŠ¥ - ${new Date().toLocaleDateString('zh-CN')}`,
  html: summaryHtml,
});
```

**Resend çš„ç‰¹ç‚¹ï¼š**
- ç°ä»£åŒ–çš„ API è®¾è®¡
- å…è´¹é¢åº¦ï¼šæ¯æœˆ 3000 å°é‚®ä»¶
- é«˜é€è¾¾ç‡
- æ”¯æŒ HTML é‚®ä»¶
- ç®€å•çš„è®¤è¯æœºåˆ¶

### 4. GitHub Actions è‡ªåŠ¨åŒ–

**Workflow é…ç½®æ–‡ä»¶ï¼š** `.github/workflows/daily.yml`

```yaml
name: Daily Trending Job
on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤© UTC 1:00ï¼ˆåŒ—äº¬æ—¶é—´ 9:00ï¼‰
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  send-report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm install
      - name: Run Script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
        run: node index.js
```

**å…³é”®é…ç½®è¯´æ˜ï¼š**

1. **å®šæ—¶è§¦å‘**
   - `cron: '0 1 * * *'`ï¼šæ¯å¤© UTC 1:00 è¿è¡Œ
   - å¯¹åº”åŒ—äº¬æ—¶é—´æ—©ä¸Š 9:00

2. **æ‰‹åŠ¨è§¦å‘**
   - `workflow_dispatch`ï¼šå…è®¸åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œ
   - æ–¹ä¾¿æµ‹è¯•å’Œè°ƒè¯•

3. **ç¯å¢ƒå‡†å¤‡**
   - `actions/checkout@v4`ï¼šæ‹‰å–ä»£ç 
   - `actions/setup-node@v4`ï¼šé…ç½® Node.js ç¯å¢ƒ
   - `npm install`ï¼šå®‰è£…ä¾èµ–

4. **å¯†é’¥ç®¡ç†**
   - é€šè¿‡ `${{ secrets.XXX }}` å¼•ç”¨ GitHub Secrets
   - é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

## å®Œæ•´éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º GitHub ä»“åº“

```bash
# æœ¬åœ°åˆå§‹åŒ–ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
git init
git add .
git commit -m "Initial commit"

# åˆ›å»ºè¿œç¨‹ä»“åº“ï¼ˆä½¿ç”¨ GitHub MCPï¼‰
# æˆ–åœ¨ GitHub ç½‘é¡µä¸Šæ‰‹åŠ¨åˆ›å»º

# å…³è”è¿œç¨‹ä»“åº“
git remote add origin git@github.com:username/github-trending-bot.git
git push -u origin main
```

**é‡åˆ°çš„é—®é¢˜ä¸è§£å†³ï¼š**

1. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```bash
   # é…ç½® Git ä»£ç†
   git config --global http.proxy http://127.0.0.1:7890
   git config --global https.proxy https://127.0.0.1:7890
   ```

2. **SSH ç«¯å£è¢«é˜»æ­¢**
   ```bash
   # é…ç½® SSH ä½¿ç”¨ 443 ç«¯å£
   # ~/.ssh/config
   Host github.com
     HostName ssh.github.com
     Port 443
     User git
   ```

3. **è¿œç¨‹ä»“åº“å†²çª**
   ```bash
   # å¼ºåˆ¶æ¨é€æœ¬åœ°ç‰ˆæœ¬
   git push -u origin main -f
   ```

### ç¬¬äºŒæ­¥ï¼šé…ç½® API Keys

1. **è·å– Gemini API Key**
   - è®¿é—®ï¼šhttps://aistudio.google.com/app/apikey
   - ç™»å½• Google è´¦å·
   - åˆ›å»ºæ–°çš„ API Key
   - ä¿å­˜å¯†é’¥ï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼‰

2. **è·å– Resend API Key**
   - è®¿é—®ï¼šhttps://resend.com/
   - æ³¨å†Œè´¦å·ï¼ˆå…è´¹ï¼‰
   - è¿›å…¥ Dashboard â†’ API Keys
   - åˆ›å»ºæ–°çš„ API Key
   - éªŒè¯å‘ä»¶äººé‚®ç®±åœ°å€

3. **é…ç½® GitHub Secrets**
   - è¿›å…¥ä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions
   - ç‚¹å‡» "New repository secret"
   - æ·»åŠ ä¸¤ä¸ª Secretï¼š
     * Name: `GEMINI_API_KEY`ï¼ŒValue: ä½ çš„ Gemini Key
     * Name: `RESEND_API_KEY`ï¼ŒValue: ä½ çš„ Resend Key

**æ³¨æ„äº‹é¡¹ï¼š**
- Secret åç§°å¿…é¡»ä¸ workflow æ–‡ä»¶ä¸­çš„å®Œå…¨åŒ¹é…
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
- API Key è¿‡æœŸåéœ€è¦é‡æ–°ç”Ÿæˆå¹¶æ›´æ–°

### ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹é‚®ä»¶é…ç½®

**æ— éœ€ä¿®æ”¹ä»£ç **ï¼Œé‚®ç®±åœ°å€å·²é€šè¿‡ç¯å¢ƒå˜é‡ `RECIPIENT_EMAIL` é…ç½®ï¼š

```javascript
const { data, error } = await resend.emails.send({
  from: 'GitHub Daily <onboarding@resend.dev>',
  to: [process.env.RECIPIENT_EMAIL],  // ä»ç¯å¢ƒå˜é‡è¯»å–
  subject: `ä»Šæ—¥ GitHub è¶‹åŠ¿æ—©æŠ¥ - ${new Date().toLocaleDateString('zh-CN')}`,
  html: summaryHtml,
});
```

**é…ç½®æ–¹å¼ï¼š**
- æœ¬åœ°å¼€å‘ï¼šåœ¨ `.env.local` æ–‡ä»¶ä¸­è®¾ç½® `RECIPIENT_EMAIL=your-email@example.com`
- GitHub Actionsï¼šåœ¨ Repository secrets ä¸­æ·»åŠ  `RECIPIENT_EMAIL` å¯†é’¥

**Resend å…è´¹ç‰ˆé™åˆ¶ï¼š**
- åªèƒ½å‘é€åˆ°å·²éªŒè¯çš„é‚®ç®±åœ°å€
- æ¯æœˆ 3000 å°é‚®ä»¶é¢åº¦
- å‘ä»¶äººåœ°å€ï¼š`<anything>@resend.dev`

### ç¬¬å››æ­¥ï¼šæµ‹è¯•è¿è¡Œ

1. è¿›å…¥ä»“åº“çš„ **Actions** æ ‡ç­¾
2. é€‰æ‹© "Daily Trending Job" workflow
3. ç‚¹å‡» "Run workflow" â†’ "Run workflow" æŒ‰é’®
4. ç­‰å¾… 2-3 åˆ†é’Ÿ
5. æ£€æŸ¥é‚®ç®±æ˜¯å¦æ”¶åˆ°æ—¥æŠ¥

## é¡¹ç›®æ–‡ä»¶ç»“æ„

```
github-trending-bot/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ daily.yml          # GitHub Actions å·¥ä½œæµé…ç½®
â”œâ”€â”€ doc/
â”‚   â””â”€â”€ é¡¹ç›®å®ç°æ–¹æ³•æ€»ç»“.md     # æœ¬æ–‡æ¡£
â”œâ”€â”€ index.js                   # ä¸»ç¨‹åº
â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ package-lock.json          # ä¾èµ–ç‰ˆæœ¬é”å®š
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.local                 # æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .gitignore                 # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
```

## å…³é”®ä»£ç è§£æ

### é”™è¯¯å¤„ç†æœºåˆ¶

```javascript
async function run() {
  try {
    // æ£€æŸ¥ç¯å¢ƒå˜é‡
    if (!process.env.GEMINI_API_KEY) {
      throw new Error("GEMINI_API_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®");
    }
    if (!process.env.RESEND_API_KEY) {
      throw new Error("RESEND_API_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®");
    }

    // æ‰§è¡Œä¸»é€»è¾‘
    // ...

    // é‚®ä»¶å‘é€å¤±è´¥æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ
    if (error) {
      console.error("é‚®ä»¶å‘é€å¤±è´¥è¯¦æƒ…:", JSON.stringify(error, null, 2));
      // å°è¯•å‘é€çº¯æ–‡æœ¬ç‰ˆæœ¬
      const { data: textData, error: textError } = await resend.emails.send({
        from: 'GitHub Daily <onboarding@resend.dev>',
        to: [process.env.RECIPIENT_EMAIL],  // ä½¿ç”¨ç¯å¢ƒå˜é‡
        subject: `ä»Šæ—¥ GitHub è¶‹åŠ¿æ—©æŠ¥ - ${new Date().toLocaleDateString('zh-CN')}`,
        text: `ä»Šæ—¥ GitHub Trending æ—¥æŠ¥\n\nå·²æŠ“å– ${projects.length} ä¸ªé¡¹ç›®ã€‚`,
      });
    }
  } catch (err) {
    console.error("æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™:", err.message);
    process.exit(1);
  }
}
```

### ç¯å¢ƒå˜é‡åŠ è½½

```javascript
// å¿…é¡»åœ¨æ–‡ä»¶æœ€å¼€å§‹åŠ è½½
require('dotenv').config({ path: '.env.local' });
```

- æœ¬åœ°å¼€å‘ï¼šä» `.env.local` æ–‡ä»¶è¯»å–
- GitHub Actionsï¼šä» Secrets æ³¨å…¥ç¯å¢ƒå˜é‡

## å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. API Key è¿‡æœŸ
**é—®é¢˜ï¼š** `[400 Bad Request] API key expired`

**è§£å†³ï¼š**
- è®¿é—® API æä¾›å•†ç½‘ç«™é‡æ–°ç”Ÿæˆ Key
- æ›´æ–° GitHub Secrets ä¸­çš„å€¼
- é‡æ–°è¿è¡Œ workflow

### 2. é‚®ä»¶å‘é€å¤±è´¥
**é—®é¢˜ï¼š** `Headers.append: "***" is an invalid header value`

**å¯èƒ½åŸå› ï¼š**
- API Key æ ¼å¼é”™è¯¯ï¼ˆæœ‰ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰
- API Key æœªæ¿€æ´»
- é‚®ç®±åœ°å€æœªéªŒè¯

**è§£å†³ï¼š**
- æ£€æŸ¥ Secret é…ç½®æ˜¯å¦æ­£ç¡®
- é‡æ–°ç”Ÿæˆ API Key
- åœ¨ Resend æ§åˆ¶å°éªŒè¯é‚®ç®±

### 3. æŠ“å–å¤±è´¥
**é—®é¢˜ï¼š** GitHub Trending é¡µé¢ç»“æ„å˜åŒ–

**è§£å†³ï¼š**
- è®¿é—® https://github.com/trending æ£€æŸ¥é¡µé¢
- æ›´æ–° `cheerio` é€‰æ‹©å™¨
- æ·»åŠ æ›´å¤šé”™è¯¯å¤„ç†

### 4. GitHub Actions ä¸è¿è¡Œ
**é—®é¢˜ï¼š** Cron å®šæ—¶ä»»åŠ¡æ²¡æœ‰è§¦å‘

**å¯èƒ½åŸå› ï¼š**
- ä»“åº“ä¸æ´»è·ƒï¼ˆGitHub ä¼šæš‚åœï¼‰
- Workflow æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯
- Actions æƒé™æœªå¼€å¯

**è§£å†³ï¼š**
- åœ¨ Settings â†’ Actions â†’ General ä¸­å¯ç”¨ Actions
- æ£€æŸ¥ YAML è¯­æ³•
- æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ä¿æŒæ´»è·ƒ

## æ€§èƒ½ä¸æˆæœ¬

### è¿è¡Œæˆæœ¬
- **GitHub Actions**ï¼šå…è´¹ï¼ˆå…¬å¼€ä»“åº“ï¼‰
- **Gemini API**ï¼šå…è´¹é¢åº¦è¶³å¤Ÿï¼ˆæ¯å¤© 1 æ¬¡è°ƒç”¨ï¼‰
- **Resend**ï¼šå…è´¹ç‰ˆæ¯æœˆ 3000 å°

**æ€»æˆæœ¬ï¼šå®Œå…¨å…è´¹** âœ…

### è¿è¡Œæ—¶é—´
- å®Œæ•´æµç¨‹ï¼š2-3 åˆ†é’Ÿ
  - ç¯å¢ƒå‡†å¤‡ï¼š~10s
  - npm installï¼š~3s
  - æŠ“å–æ•°æ®ï¼š~2s
  - AI ç”Ÿæˆï¼š~30-60s
  - å‘é€é‚®ä»¶ï¼š~1s

## æ‰©å±•å»ºè®®

### 1. æ”¯æŒå¤šè¯­è¨€
```javascript
// å¯ä»¥æŠ“å–ä¸åŒè¯­è¨€çš„ Trending
const languages = ['javascript', 'python', 'go'];
for (const lang of languages) {
  await fetch(`https://github.com/trending/${lang}`);
}
```

### 2. æ”¯æŒå¤šé‚®ç®±
```javascript
// ä»ç¯å¢ƒå˜é‡è¯»å–å¤šä¸ªé‚®ç®±ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
const recipients = process.env.RECIPIENT_EMAIL.split(',').map(e => e.trim());

for (const email of recipients) {
  await resend.emails.send({ to: [email], ... });
}

// æˆ–è€…åœ¨ .env.local ä¸­é…ç½®ï¼š
// RECIPIENT_EMAIL=user1@example.com,user2@example.com,user3@example.com
```

### 3. æ•°æ®æŒä¹…åŒ–
- ä½¿ç”¨ GitHub Issues å­˜å‚¨å†å²æ•°æ®
- æ·»åŠ æ•°æ®åº“æ”¯æŒï¼ˆå¦‚ MongoDB Atlas å…è´¹ç‰ˆï¼‰
- ç”Ÿæˆè¶‹åŠ¿åˆ†æå›¾è¡¨

### 4. å®šåˆ¶åŒ–æŠ¥å‘Š
- æ ¹æ®ç”¨æˆ·å…´è¶£ç­›é€‰é¡¹ç›®
- æ”¯æŒè‡ªå®šä¹‰ Prompt
- æ·»åŠ é¡¹ç›®æ˜Ÿæ ‡å†å²è¶‹åŠ¿

### 5. é€šçŸ¥æ–¹å¼å¤šæ ·åŒ–
- æ·»åŠ  Discord/Slack Webhook
- æ”¯æŒå¾®ä¿¡å…¬ä¼—å·æ¨é€
- ç”Ÿæˆ RSS è®¢é˜…

## æ€»ç»“

æœ¬é¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ç»“åˆç°ä»£æŠ€æœ¯æ ˆæ„å»ºä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„ä¿¡æ¯èšåˆä¸æ¨é€ç³»ç»Ÿï¼š

1. **æ•°æ®è·å–**ï¼šç½‘é¡µçˆ¬å–æŠ€æœ¯
2. **å†…å®¹ç”Ÿæˆ**ï¼šAI å¤§æ¨¡å‹åº”ç”¨
3. **è‡ªåŠ¨å‘é€**ï¼šé‚®ä»¶æœåŠ¡é›†æˆ
4. **å®šæ—¶æ‰§è¡Œ**ï¼šGitHub Actions è°ƒåº¦

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨å…è´¹
- âœ… æ— éœ€æœåŠ¡å™¨
- âœ… è‡ªåŠ¨è¿è¡Œ
- âœ… æ˜“äºéƒ¨ç½²
- âœ… å¯æ‰©å±•æ€§å¼º

é€šè¿‡æœ¬é¡¹ç›®ï¼Œä½ å¯ä»¥å­¦ä¹ åˆ°ï¼š
- Node.js å¼‚æ­¥ç¼–ç¨‹
- ç½‘é¡µæ•°æ®æŠ“å–
- AI API é›†æˆ
- GitHub Actions ä½¿ç”¨
- ç¯å¢ƒå˜é‡ç®¡ç†
- é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

å¸Œæœ›è¿™ä¸ªé¡¹ç›®èƒ½å¤Ÿå¸®åŠ©ä½ æ¯å¤©åŠæ—¶äº†è§£ GitHub ä¸Šçš„çƒ­é—¨é¡¹ç›®ï¼ğŸ‰
