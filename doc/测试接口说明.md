# 测试接口使用说明

## 快速开始

### 1. 完整测试（推荐）
查看所有抓取的数据和传递给 AI 的信息：

```bash
npm test
```

### 2. 简化测试
只显示项目列表：

```bash
npm run test:simple
```

### 3. 测试特定语言
```bash
# JavaScript 项目
npm run test:lang javascript

# Python 项目
npm run test:lang python

# Go 项目
npm run test:lang go
```

## 输出说明

### 完整测试模式输出内容：

#### 1. 原始数据结构
显示前 3 个项目的完整 JSON 数据：
```json
{
  "name": "username/repo-name",
  "url": "https://github.com/username/repo-name",
  "description": "项目描述",
  "language": "JavaScript",
  "stars": "1,234",
  "todayStars": "100 stars today"
}
```

#### 2. 数据字段统计
显示每个字段的有效数据数量：
```
┌─────────────┬────────┐
│   字段      │  数量  │
├─────────────┼────────┤
│ name        │   25   │
│ url         │   25   │
│ description │   23   │
│ language    │   24   │
│ stars       │   25   │
│ todayStars  │   25   │
└─────────────┴────────┘
```

#### 3. 编程语言分布
统计各语言项目数量：
```
┌────────────┬────────┐
│   语言     │  数量  │
├────────────┼────────┤
│ JavaScript │   8    │
│ Python     │   6    │
│ TypeScript │   4    │
│ Go         │   3    │
└────────────┴────────┘
```

#### 4. 完整项目列表
显示所有项目的详细信息

#### 5. 传递给 AI 的格式化文本
完整显示发送给 Gemini 的项目数据文本

#### 6. AI 提示词预览
显示提示词的前 500 字符

#### 7. 数据统计
- 抓取项目数
- 格式化文本长度
- 完整提示词长度
- 预计 Token 数

## 使用场景

### 调试数据抓取
```bash
# 查看是否正确抓取到数据
npm test

# 检查特定语言的抓取
npm run test:lang rust
```

### 验证数据格式
```bash
# 查看传递给 AI 的数据格式是否正确
npm test
```

### 优化提示词
```bash
# 查看当前提示词的内容和长度
npm test | grep "提示词"
```

### 分析 Trending 趋势
```bash
# 查看语言分布
npm test | grep "编程语言分布" -A 20
```

## 高级用法

### 保存测试结果到文件
```bash
npm test > test-results.txt
```

### 只查看项目列表
```bash
npm test | grep "完整项目列表" -A 100
```

### 查看特定信息
```bash
# 只看统计信息
npm test | grep "数据统计" -A 10

# 只看语言分布
npm test | grep "编程语言分布" -A 20
```

## 测试流程

```
┌─────────────────────┐
│  运行测试脚本       │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  抓取 GitHub        │
│  Trending 数据      │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  显示原始数据       │
│  (JSON 格式)        │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  统计分析           │
│  (字段、语言等)     │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  格式化文本         │
│  (传给 AI 的)       │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  显示提示词预览     │
└──────────┬──────────┘
           ↓
┌─────────────────────┐
│  输出统计信息       │
└─────────────────────┘
```

## 注意事项

1. **网络连接**：需要能访问 github.com
2. **代理配置**：如需代理，确保已配置（参考主文档）
3. **不调用 AI**：测试脚本不会调用 Gemini API，无需 API Key
4. **不发送邮件**：测试脚本不会发送邮件

## 故障排除

### 抓取失败
```bash
# 检查网络连接
curl https://github.com/trending

# 检查代理配置
echo $https_proxy
```

### 数据为空
可能原因：
- GitHub 页面结构变化
- 网络问题
- 被 GitHub 限制访问

### 显示乱码
```bash
# 设置正确的终端编码
export LANG=zh_CN.UTF-8
```

## 示例输出

```
============================================================
开始测试数据抓取...
============================================================

[INFO] 正在抓取 GitHub Trending 数据...
[SUCCESS] 成功抓取到 25 个项目

📊 原始数据结构（前 3 个项目）:
------------------------------------------------------------

[项目 1]
{
  "name": "anthropics/anthropic-sdk-python",
  "url": "https://github.com/anthropics/anthropic-sdk-python",
  "description": "Python SDK for Anthropic's Claude API",
  "language": "Python",
  "stars": "1,234",
  "todayStars": "123 stars today"
}

...（省略）

[SUCCESS] ✨ 测试完成！
```

## 集成到开发流程

### 提交前测试
```bash
# .git/hooks/pre-commit
npm test --simple
```

### CI/CD 集成
```yaml
# .github/workflows/test.yml
- name: Test Data Scraping
  run: npm test
```

这个测试接口可以帮助你：
- ✅ 验证数据抓取是否正常
- ✅ 查看传递给 AI 的确切内容
- ✅ 调试和优化提示词
- ✅ 分析 Trending 趋势
